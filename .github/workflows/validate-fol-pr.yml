name: Validate FOL with Check Run

on:
    pull_request:
        branches: [main]
        paths:
            - "fol/**/*.fol"

jobs:
    validate-fol:
        runs-on: ubuntu-latest
        permissions:
            contents: read
            checks: write # Check Run 결과를 기록하기 위한 권한
            pull-requests: read

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0 # 전체 히스토리를 가져옵니다.
              # 저장소의 전체 커밋 히스토리를 가져오므로, base와 head commit diff가 가능합니다.

            - name: Identify changed .fol files using commit SHAs
              id: find_files
              run: |
                  echo "base sha: ${{ github.event.pull_request.base.sha }}"
                  echo "head sha: ${{ github.event.pull_request.head.sha }}"
                  # base commit과 head commit 사이의 diff를 계산합니다.
                  CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }} -- "fol/**/*.fol")
                  echo "CHANGED_FILES: [$CHANGED_FILES]"
                  echo "::set-output name=files::$CHANGED_FILES"

            - name: Exit if no .fol file changed
              if: steps.find_files.outputs.files == ''
              run: |
                  echo "No .fol files changed. Exiting."
                  exit 0

            # 이후 payload 생성, API 호출 등의 단계 진행…
