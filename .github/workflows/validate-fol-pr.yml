name: Retrieve All Changed Files

on:
    pull_request:
        branches: [main]

jobs:
    diff:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0 # 전체 히스토리를 가져와 base와 head 커밋 비교가 가능하도록 합니다.

            - name: Get all changed files
              id: diff
              run: |
                  echo "Base SHA: ${{ github.event.pull_request.base.sha }}"
                  echo "Head SHA: ${{ github.event.pull_request.head.sha }}"
                  # base와 head 사이의 모든 변경 파일을 가져옵니다.
                  CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }})
                  echo "CHANGED_FILES: [$CHANGED_FILES]"
                  # set-output 명령어를 사용하여 다음 스텝에 변경 파일 목록을 전달합니다.
                  echo "::set-output name=files::$CHANGED_FILES"

            - name: Show Changed Files
              run: |
                  echo "Changed Files: ${{ steps.diff.outputs.files }}"
